<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>لعبة صبي السكر - احترافية</title>
<style>
body { margin: 0; overflow: hidden; background-color: #a0e7e5; font-family: Arial, sans-serif; }
canvas { display: block; margin: 0 auto; background: linear-gradient(to top, #80c080, #c0f0ff); }
#info { position: absolute; top: 10px; left: 10px; font-size: 18px; color: #333; }
#endScreen { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); color:white; display:none; justify-content:center; align-items:center; flex-direction:column; font-size:24px; }
#endScreen button { padding:10px 20px; margin-top:20px; font-size:20px; cursor:pointer; }
</style>
</head>
<body>
<div id="info">
  الصحة: <span id="health">100</span> |
  السكر: <span id="sugar">90</span> |
  النقاط: <span id="score">0</span>
</div>
<div id="endScreen">
  <div id="finalScore">النقاط النهائية: 0</div>
  <div id="advice"></div>
  <button onclick="restartGame()">إعادة اللعب</button>
</div>

<canvas id="gameCanvas" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = {
  x: 50, y: 300, width: 50, height: 50,
  health: 100, sugar: 90, sizeMultiplier: 1
};

let foods = [];
let obstacles = [];
let keys = {};
let score = 0;
let speed = 5;

// Sprites
let playerImg = new Image();
playerImg.src = "player_healthy.png";

// Sounds
let collectSound = new Audio("collect.mp3");
let hitSound = new Audio("hit.mp3");

// التحكم
document.addEventListener('keydown', e => keys[e.code] = true);
document.addEventListener('keyup', e => keys[e.code] = false);

// توليد الطعام والعقبات
function spawnFood() {
  const type = Math.random() < 0.6 ? 'healthy' : 'unhealthy';
  foods.push({
    x: canvas.width, y: 300, width: 30, height: 30, type: type
  });
}

function spawnObstacle() {
  obstacles.push({
    x: canvas.width, y: 320, width: 30, height: 30, color: 'brown'
  });
}

// تحديث الصورة حسب الصحة
function updatePlayerImage() {
  if (player.health > 70) playerImg.src = "player_healthy.png";
  else if (player.health > 30) playerImg.src = "player_medium.png";
  else playerImg.src = "player_unhealthy.png";
}

// التصادم
function collide(a, b) {
  return a.x < b.x + b.width &&
         a.x + a.width * a.sizeMultiplier > b.x &&
         a.y < b.y + b.height &&
         a.y + a.height * a.sizeMultiplier > b.y;
}

// تحديث المعلومات
function updateInfo() {
  document.getElementById('health').textContent = player.health;
  document.getElementById('sugar').textContent = player.sugar;
  document.getElementById('score').textContent = score;
}

// إعادة اللعبة
function restartGame() {
  player.health = 100; player.sugar = 90; score = 0; speed = 5;
  player.sizeMultiplier = 1;
  foods = []; obstacles = [];
  document.getElementById('endScreen').style.display = 'none';
  gameLoop();
}

// التحديث
function update() {
  if (keys['ArrowUp'] && player.y > 0) player.y -= 5;
  if (keys['ArrowDown'] && player.y + player.height < canvas.height) player.y += 5;

  foods.forEach(f => f.x -= speed);
  obstacles.forEach(o => o.x -= speed);

  // تصادم الطعام
  foods = foods.filter(f => {
    if (collide(player, f)) {
      if (f.type === 'healthy') {
        player.health = Math.min(player.health + 5, 100);
        player.sugar = Math.max(player.sugar - 2, 70);
        player.sizeMultiplier += 0.05;
        score += 10;
        collectSound.play();
      } else {
        player.health = Math.max(player.health - 10, 0);
        player.sugar = Math.min(player.sugar + 5, 150);
        player.sizeMultiplier = Math.max(player.sizeMultiplier - 0.05, 0.5);
        score -= 5;
        hitSound.play();
      }
      updateInfo();
      updatePlayerImage();
      return false;
    }
    return f.x + f.width > 0;
  });

  // تصادم العقبات
  obstacles = obstacles.filter(o => {
    if (collide(player, o)) {
      player.health = Math.max(player.health - 5, 0);
      hitSound.play();
      updateInfo();
      updatePlayerImage();
      return false;
    }
    return o.x + o.width > 0;
  });

  // صعوبة متزايدة
  if (score > 0 && score % 100 === 0) speed = 5 + Math.floor(score/100);
}

// الرسم
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(playerImg, player.x, player.y, player.width * player.sizeMultiplier, player.height * player.sizeMultiplier);

  foods.forEach(f => {
    let img = new Image();
    img.src = f.type === 'healthy' ? "food_healthy.png" : "food_unhealthy.png";
    ctx.drawImage(img, f.x, f.y, f.width, f.height);
  });

  obstacles.forEach(o => {
    ctx.fillStyle = o.color;
    ctx.fillRect(o.x, o.y, o.width, o.height);
  });
}

// شاشة النهاية
function gameOver() {
  document.getElementById('finalScore').textContent = "النقاط النهائية: " + score;
  let advice = "حافظ على غذائك الصحي لمستوى سكر متوازن!";
  if(player.sugar > 120) advice = "انتباه! مستوى السكر مرتفع. حاول تجنب السكر.";
  document.getElementById('advice').textContent = advice;
  document.getElementById('endScreen').style.display = 'flex';
}

// اللعبة الرئيسية
let foodTimer = 0;
let obstacleTimer = 0;

function gameLoop() {
  update();
  draw();

  foodTimer++;
  if (foodTimer > 50) { spawnFood(); foodTimer = 0; }

  obstacleTimer++;
  if (obstacleTimer > 120) { spawnObstacle(); obstacleTimer = 0; }

  if (player.health > 0) {
    requestAnimationFrame(gameLoop);
  } else {
    gameOver();
  }
}

updateInfo();
updatePlayerImage();
gameLoop();

</script>
</body>
</html>

